
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../docker/">
      
      
        <link rel="next" href="../cda/">
      
      
      <link rel="icon" href="../assets/favicon-96x96.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.45">
    
    
      
        <title>Matchbox Engine - Matchbox</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="matchbox" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#matchbox-engine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Matchbox" class="md-header__button md-logo" aria-label="Matchbox" data-md-component="logo">
      
  <img src="../assets/matchbox_logo_color.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Matchbox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Matchbox Engine
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Matchbox" class="md-nav__button md-logo" aria-label="Matchbox" data-md-component="logo">
      
  <img src="../assets/matchbox_logo_color.png" alt="logo">

    </a>
    Matchbox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Features
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validation of FHIR resources
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API for Matchbox
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matchbox container
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Matchbox Engine
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Matchbox Engine
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#library-based-on-matchbox-and-hapi-fhir-orghl7fhircore" class="md-nav__link">
    <span class="md-ellipsis">
      Library based on matchbox and hapi-fhir / org.hl7.fhir.core
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Library based on matchbox and hapi-fhir / org.hl7.fhir.core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integrate-matchbox-engine-with-maven" class="md-nav__link">
    <span class="md-ellipsis">
      Integrate matchbox-engine with Maven
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-and-javadoc" class="md-nav__link">
    <span class="md-ellipsis">
      API and Javadoc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API and Javadoc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    <span class="md-ellipsis">
      Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-fhir-mapping-language-for-transformation" class="md-nav__link">
    <span class="md-ellipsis">
      Using the FHIR Mapping Language for transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cda-to-fhir-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      CDA to FHIR mapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CDA Logical Model
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#library-based-on-matchbox-and-hapi-fhir-orghl7fhircore" class="md-nav__link">
    <span class="md-ellipsis">
      Library based on matchbox and hapi-fhir / org.hl7.fhir.core
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Library based on matchbox and hapi-fhir / org.hl7.fhir.core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integrate-matchbox-engine-with-maven" class="md-nav__link">
    <span class="md-ellipsis">
      Integrate matchbox-engine with Maven
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-and-javadoc" class="md-nav__link">
    <span class="md-ellipsis">
      API and Javadoc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API and Javadoc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    <span class="md-ellipsis">
      Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-fhir-mapping-language-for-transformation" class="md-nav__link">
    <span class="md-ellipsis">
      Using the FHIR Mapping Language for transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cda-to-fhir-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      CDA to FHIR mapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="matchbox-engine">Matchbox Engine</h1>
<p>Matchbox engine has been created to allow a standalone FHIR validation and transformation without the need for a connection to the internet:</p>
<ul>
<li>java library</li>
<li>supports CDA to FHIR mapping</li>
<li>FHIR validation with no external terminology server</li>
<li>local configuration (no internet access necessary, ig packages can be loaded directly from classpath)</li>
<li><a href="../apidocs/">javadoc</a></li>
</ul>
<p>default fhir package configuration:</p>
<ul>
<li>cda-uv-core-2.0#2.0.0-sd-202406-matchbox-patch.tgz</li>
<li>hl7.fhir.r4.core.tgz</li>
<li>hl7.fhir.xver-extensions#0.1.0.tgz</li>
<li>hl7.terminology.r4#6.1.0.tgz</li>
<li>hl7.fhir.uv.extensions.r4#1.0.0.tgz</li>
</ul>
<h2 id="library-based-on-matchbox-and-hapi-fhir-orghl7fhircore">Library based on matchbox and hapi-fhir / org.hl7.fhir.core</h2>
<p>The transformation and validation functionality has been extracted out of matchbox (<a href="https://github.com/ahdis/matchbox">https://github.com/ahdis/matchbox</a>) into the matchbox-engine (<a href="https://github.com/ahdis/matchbox/tree/main/matchbox-engine">https://github.com/ahdis/matchbox/tree/main/matchbox-engine</a>) library. This has been done in a way, that the matchbox project contains different modules:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>[INFO] ------------------------------------------------------------------------
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>[INFO] Reactor Build Order:
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>[INFO]
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>[INFO] matchbox                                                           [pom]
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>[INFO] matchbox-engine                                                    [jar]
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>[INFO] matchbox-server                                                    [jar]
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>[INFO]
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>[INFO] ----------------------&lt; matchbox.health:matchbox &gt;----------------------
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>[INFO] Building matchbox 3.0.0-SNAPSHOT                                   [1/4]
</span></code></pre></div>
<p>matchbox-engine creates the java library, matchbox-engine-cli adds all dependencies as a fat jar which can be directly executed (&gt;100 MB) and matchbox-server provides the FHIR API as a microservice. It also uses matchbox-engine, so if matchbox is used during developing and testing the mapping, matchbox-engine will deliver the same result.</p>
<p>matchbox-engine is only based on org.hl7.fhir.core libraries (HAPI FHIR - HL7 FHIR Core Artifacts), the dependency to hapi-fhir is not necessary for the library. The library is derived from the <a href="https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator">HL7 Java FHIR Validator</a> and <a href="https://www.hl7.org/fhir/mapping-language.html">FHIR Mapping Language</a> implementation. During the development of the mapping a few missing functionalities in the Mapping Language have been discovered and have been also contributed back to the org.hl7.fhir.core project (<a href="https://github.com/hapifhir/org.hl7.fhir.core/pulls?q=is%3Apr+is%3Aclosed+author%3Aoliveregger+">Pull requests</a>). Note however that there are some classes patched in matchbox-engine because of peculiarities in the parsing/mapping of CDA and package handling (<a href="https://github.com/ahdis/matchbox/tree/main/matchbox-engine/src/main/java/org/hl7/fhir">patched files</a>). These patched files are <a href="https://github.com/ahdis/matchbox/blob/main/updatehapi.sh">updated</a> and changes applied during each new release of org.hl7.fhir.core and tests are run to verify the correctness of the defined mappings. The library requires JDK11 which is also the minimum requirement for HAPI FHIR - HL7 FHIR Core Artifacts.</p>
<h3 id="integrate-matchbox-engine-with-maven">Integrate matchbox-engine with Maven</h3>
<p>You can add the matchbox-engine dependency in your <code>pom.xml</code>:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>health.matchbox<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>matchbox-engine<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<h2 id="api-and-javadoc">API and Javadoc</h2>
<p>The source code is documented with <a href="https://ahdis.github.io/matchbox/apidocs/">Javadoc</a>. Test cases illustrate the main functionality for transformation with the <a href="https://github.com/ahdis/matchbox/blob/main/matchbox-engine/src/test/java/ch/ahdis/matchbox/engine/tests/FhirMappingLanguageTests.java">FHIR Mapping Language</a> and for <a href="https://github.com/ahdis/matchbox/blob/main/matchbox-engine/src/test/java/ch/ahdis/matchbox/engine/tests/CdaToFhirTransformTests.java">CDA to FHIR transformation</a>.</p>
<p>For validation or transformation, you need to instantiate a matchbox-engine. This matchbox-engine can be configured
with a specific version of an implementation guide and its dependencies. You can instantiate multiple engines with different ig's.</p>
<h3 id="validation">Validation</h3>
<p>Validaton is currently supported for FHIR R4. You can get an instance of matchbox-engine the following way:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MatchboxEngineBuilder</span><span class="p">().</span><span class="na">getEngineR4</span><span class="p">();</span>
</span></code></pre></div>
<p>This engine is configured with the core libraries for FHIR Release 4 (hl7.fhir.r4.core.tgz, hl7.fhir.xver-extensions#0.0.13.tgz, hl7.terminology#5.1.0.tgz). You can then invoke the validation with</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">InputStream</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CdaToFhirTransformTests</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="s">&quot;/pat.json&quot;</span><span class="p">);</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">org</span><span class="p">.</span><span class="na">hl7</span><span class="p">.</span><span class="na">fhir</span><span class="p">.</span><span class="na">r4</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">OperationOutcome</span><span class="w"> </span><span class="n">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engine</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="n">FhirFormat</span><span class="p">.</span><span class="na">JSON</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://hl7.org/fhir/StructureDefinition/Patient&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>You have the ability to add additional implementation guides to the engine (e.g. if you wan’t to support validation for your implementation guide).
The engine will look for it in the local disk cache or in the remote FHIR package repository.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">engine</span><span class="p">.</span><span class="na">loadPackage</span><span class="p">(</span><span class="s">&quot;ihe.formatcode.fhir&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>It is possible to load an IG from the content of its NPM package, but its dependencies won't be automatically fetched.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">engine</span><span class="p">.</span><span class="na">loadPackage</span><span class="p">(</span><span class="n">getClass</span><span class="p">().</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="s">&quot;/myig.tgz&quot;</span><span class="p">));</span>
</span></code></pre></div>
<p>You can create also a new instance based on an existing engine. This might be needed if you want to update conformance resources in an instance or if you want to have support for validation with different versions of ig’s (an engine can only be configured with one ig version, there is no support that an engine has two versions of the same ig).</p>
<h3 id="using-the-fhir-mapping-language-for-transformation">Using the FHIR Mapping Language for transformation</h3>
<p>If the engine has been configured already with StructureMap resources (e.g. provided within an Implementation Guide) the transformation can be directly called:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">Resource</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engine</span><span class="p">.</span><span class="na">transformToFhir</span><span class="p">(</span><span class="n">getFileAsStringFromResources</span><span class="p">(</span><span class="s">&quot;/qr.json&quot;</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://ahdis.ch/matchbox/fml/qr2patgender&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>If you wan’t to provide the StructureMap yourself you can parse a FHIR Mapping Language map file and add the StructureMap resource then to the engine.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">StructureMap</span><span class="w"> </span><span class="n">sm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engine</span><span class="p">.</span><span class="na">parseMap</span><span class="p">(</span><span class="n">getFileAsStringFromResources</span><span class="p">(</span><span class="s">&quot;/qr2patgender.map&quot;</span><span class="p">));</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">engine</span><span class="p">.</span><span class="na">addCanonicalResource</span><span class="p">(</span><span class="n">sm</span><span class="p">);</span>
</span></code></pre></div>
<p>For the transformation the canonical Url of the StructureMaps has to be used.</p>
<h3 id="cda-to-fhir-mapping">CDA to FHIR mapping</h3>
<p>To support CDA to FHIR mapping (or vice versa) a specific CDAEngine is available, which is configured with <a href="https://ahdis.github.io/matchbox/cda-logical-model/index.html">CDA Logical Model</a>. To do CDA to FHIR transformations you need to write the mapping logic and provide them as StructureMap resources in an Implementation Guide. </p>
<p>You can then load the engine with those maps:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CdaMappingEngine</span><span class="p">.</span><span class="na">CdaMappingEngineBuilder</span><span class="p">().</span><span class="na">getEngine</span><span class="p">();</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">engine</span><span class="p">.</span><span class="na">loadPackage</span><span class="p">(</span><span class="n">getClass</span><span class="p">().</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="s">&quot;/cda-fhir-maps.tgz&quot;</span><span class="p">));</span>
</span></code></pre></div>
<p>And then do the transformation with</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engine</span><span class="p">.</span><span class="na">transform</span><span class="p">(</span><span class="n">cda</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToBundle&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>